# 计算机网络技术笔记
## 计算机网络体系结构
典型的计算机网络体系结构,有 OSI 参考模型和TCP/IP参考模型两种: 

其中 OSI 参考模型 自下而上包含以下七层:

    1. 物理层
    2. 数据链路层
    3. 网络层
    4. 传输层
    5. 会话层
    6. 表示层
    7. 应用层

TCP/IP 参考模型自上而下包含以下四层:

    1. 应用层
    2. 传输层
    3. 网络互连层
    4. 网络接口层

TCP/IP 参考模型与OSI参考模型的区别:

    1. Tcp/Ip 只有四层,而 OSI 有七层.主要是 OSI 中的 物理层和数据链路层 在TCP/IP 中合并起来放到了网络接口层. TCP/IP 中没有会话层和表示层.
    2. OSI 参考模型在网络层支持面向连接的和面向无连接的通信,在传输层仅有面向连接的通信;而 TCP/IP 模型在网络层仅有面向无连接的通信,但在传输层支持两种方式,给用户选择的机会.
    3. OSI 参考模型产生在具体协议发明之前,并没有偏向某种特定的协议,因此具有很好的通用性,但由于设计者之前没有实际的协议设计经验,因此很多功能不知道该放在那一层.而 TCP/IP 模型是先有的 TCP IP 等具体协议,再在这些协议的基础上建立的参考模型,因此对协议配合的很好.

TCP/IP 的共同点:

    1. 都有网络层,传输层和应用层.

下面以 OSI 的七层协议,自下而上的描述每一层的内容, 然后 两种体系都用的层,分别进行描述

    1. 物理层 ( OSI 参考模型)
       实现信号编码功能,规定数据终端设备与数据通信设备之间接口的相关特性,主要包括机械,电气,功能,和规程4个方面特性.
    2. 数据链路层 ( OSI 参考模型)
       实现在相邻结点之间的数据可靠而有效的传输.如 帧同步技术,MAC寻址技术.
    3. 网络接口层 (TCP/IP) 
       没有明确的定义,实际上,这一层大概就是 OSI 中数据链路层和物理层的内容

    4. 网络层 ( OSI 参考模型)
       网络层解决的核心问题是如何将分组通过交换网络传送至目的主机, 因此, 网络层的主要功能是数据转发与路由. 网络层也要具备寻址功能,确保分组可以被正确的传输到目的主机,比如Internet中的IP地址.
    5. 网络层 ( TCP/IP )
       网络互连层是整个 TCP/IP 参考模型的核心,主要解决把数据分组发往目的网络或主机的问题. 在 TCP/IP 参考模型中. 网络互连层的核心协议是 IP . 负责定义分组的格式和传输. 网络层还包括互联网控制报文协议 ICMP ,互联网多播组管理协议 IGMP .以及路由协议 如 BGP ,OSPF 和 RIP 等. 

    6. 传输层 ( OSI 参考模型 )
       传输层是第一个端到端的层次, 也就是进程到进程的层次. 数据的通信从表面上看是在两台主机之间进行,但实质上是发生在两个主机上的进程之间. OSI 模型的前 3 层可组成公共网络,被很多设备共享,并且 计算机-结点机  ,结点机-结点机 是按照接力的方式传送的.为了防止传送途中报文的丢失,两个主机的进程之间需要实现端到端控制,.因此传输层的功能主要包括复用/解复用 , 端到端的可靠数据传输,连接控制,流量控制和拥塞控制机制.
    7. 传输层 ( TCP/IP )
       TCP/IP 参考模型的传输层主要包括面向连接,提供可靠数据流传输的传输控制协议 TCP 和 无连接 ,不提供可靠数据传输的用户数据报协议 UDP.

    8. 会话层 ( OSI 参考模型 )
       会话层是指用户和用户的连接,它通过在两台计算机间建立,管理和终止通信来完成对话.
    9. 表示层 ( OSI 参考模型 )
       表示层主要用于处理应用实体间交换数据的语法,其目的是解决格式和数据表示的差别,从而为应用层提供一个一致的数据格式.
    10. 应用层 ( OSI 参考模型 )
       应用层与提供给用户的网络服务相关,这些服务非常非常丰富,包括文件传送,电子邮件和P2P应用等. 应用层为用户提供了一个应用网络通信的接口.

    11. 应用层 ( TCP/IP )
       TCP/IP 参考模型将 OSI 参考模型 中的会话层和表示层的功能合并到了应用层来实现. Internet  上常见的一些应用大多在这一层, 用户通过应用层来使用 Internet 提供的各种服务.例如 WWW 服务, 文件传输和电子邮件.
      
## 局域网技术 (物理层和数据链路层)

局域网技术有三种, 以太网 虚拟局域网 无线局域网. 为了将多种局域网技术纳入一个统一的协议模型, IEEE 802 委员会提出将数据链路层划分为两个子层: 逻辑链路控制子层 LLC 和 介质访问控制子层 MAC . 与接入各种传输介质有关的内容都放在MAC子层,包括将上层数据封装成帧进行发送, 寻址和比特差错检测等. LLC 层负责与介质接入无关的内容,包括建立和释放数据链路层的逻辑链接,提供帧序号,提供高层接口和差错控制等.

以太网 (有线局域网):

  - 以太网的技术规范主要包括:
   
      1. 拓扑结构 (总线型结构)
      2. 传输介质 
      3. 介质访问方式 (MAC协议)
      4. 传输速率 
      5. 最多工作站数
      6. 最远传输距离

   - MAC 介质访问控制协议,要考虑的内容有:
      1. 在某一时刻,那个节点可以发送数据
      2. 发送时是否会出现冲突
      3. 出现冲突时如何处理
      4. 以太网的 MAC 协议,采用 CSMA/CD 作为介质访问控制方法. "先监听,在发送;边发送,边监听."

   - MAC 地址, 48bit (6B) 作为局域网的全球地址,标识每一块局域网适配器(网卡).

   - MAC 帧格式:
      1. DIX Ethernet V2 以太网V2 标准 和 IEEE 802.3 
      2. MAC 帧结构中包含两个地址 目标地址和源地址,均为 48bit. 
      3. 数据字段是从上层协议接收到的数据报文,其长度被限定在 45 ~ 1500 B 之间, 如果不足 46B ,则填充到 46B .
      4. 以太网中设置两个字节作为类型字段,用来标识上一层使用的协议类型,IEEE 802.3 中也有这两个字节.当这个字段值大于 0X0600时,用于标识上一层使用的协议类型;当这个字段值小于 0x0600 时, 用于标识 MAC 帧的数据部分的字节数.
      5. FCS 字段为帧检测序列,采用循环 CRC 校验对收到的 MAC 帧进行差错检测,长度为 4B .
      6. 实际传输中, 发送端要在每个以太网MAC帧前面插入8B, 包括 7B 的前导码 和 1B 的帧前定界符,用于告知接收端数据到了,实现接收的同步. 

   - 以太网的扩展:
      1. 物理层包括 中继器和集线器
      2. 数据链路层包括 网桥和交换机

无线局域网 (WLAN):
   1. IEEE 802.11 协议
   2. 采用星型拓扑结构,无线局域网中的移动站通过无线方式与接入点 AP 相连, 再由 AP 通过有线介质连接其他网格或Internect
   3. 无线以太网 IEEE 802.11 使用 CSMA/CA  冲突避免算法 来代替 CSMA/CD 冲突检测算法.

虚拟局域网 (VLAN):

## 网络互联技术(网络层)

网络互联技术的作用: 
   1. 要让分布在世界各地,不同类型,不同协议和技术细节的网络相互连接起来,并且能顺畅, 高效地实现信息共享,就必须依靠网络互联技术来实现.网络互联技术是所有能在物理和逻辑上实现不同网络相互连接的技术的总称.

异构网络:
   1. 采用不同通信技术和运行协议的网络通常称为异构网络,如局域网中的以太网络和令牌环网,广域网中的帧中继网和ATM网等. 实现异构网络互联的基本策略主要包括协议转换和构建虚拟互联网络.
   2. 协议转换机制采用一类支持异构网络间协议转换的网络中间设备,实现异构网络间数据分组的转换和转发. 例如 支持协议转换的网桥或交换机, 多协议路由器和应用网关.
   3. 构建虚拟互联网机制的异构网络互联是在现有异构网络基础上,构建一个同构的虚拟互联网络,异构网络只需分装和转发虚拟互联网络分组,同时,引入虚拟互联网中间设备互联异构网络,实现在异构网络间转发统一的虚拟互联网的数据分组.
   4. Internet 是利用IP网络实现的全球最大的互联网络,是典型的在网络层实现的网络互联,采用同构的网络层协议 IP协议,引入网络互联设备 IP路由器.

网际协议(IP):
   1. IP协议需要与 地址解析协议 ARP, 网际控制报文协议 ICMP , 网际组管理协议 IGMP.
   2. IP是面向连接的, 不可靠的分组传输协议.
   3. IP屏蔽了数据链路层和物理层的差异,使得数据的传输和转发更加方便.
   4. IP是点对点式网络通信协议. 

IPv4 协议报文格式 报文包含首部和数据,下面介绍的是首部部分:

   - 按不同的功能做区分

   1. 版本号 占4位, 表示的是IP的版本号,IPv4 的版本号字段值为 0100
   2. 首部 占4位, 给出的是IP分组首部长度,包括可变长度的选项字段,以4B为单位.
   3. 区分服务字段 占8位,只有在网络提供区分服务时,才使用该字段
   4. 总长度字段 占16位, 给出IP分组的总字节数,包括首部和数据部分.
   5. 标识字段 占16位, 用于标识一个IP分组.IP利用一个计数器,每产生一个IP分组计数器就加1,并将计数器的值作为该 IP分组的标识.
   6. 标志位字段 占3位 结构为保留位,DF,MF.

      - 保留位
      - DF = 0 表示允许路由器将该IP分组分片,DF = 1 标识禁止路由器将 IP 分组分片. 如果路由器转发一个DF=1 的IP分组时,其总长度超过输出链路的MTU,路由器不会对该IP分组进行分片,路由器会丢弃该分组.
      - MF = 0 表示该 IP 分组是一个未被分片的IP分组或者时被分片IP分组的最后一片. MF = 1 表示该 IP 分组一定是一个IP分组的分片.

   7. 片偏移字段 占13位 ,表示一个IP分组分片封装源IP分组数据的相对偏移量,即封装的数据从那个字节开始,片偏移字段以 8B 为单位.

   8. 生存时间(TTL) 字段占8位. 表示IP分组在网络中可以通过的路由器数 (跳数). 源主机在生成 IP 分组时 设置 TTL 初值, 每经过路由器转发一次, TTL 减1, 如果TTL = 0 , 路由器则丢弃该 IP 分组,并向源主机发送 TYPE = 11, Code = 0 的 ICMP 报文.
   9. 协议字段 占8位, 指示该IP封装的是哪个协议的数据包.,例如 6 为 TCP, 17 为 UDP.
   10. 首部校验和字段 占16位. 利用校验和实现对IP分组首部的差错检测. 
   11. 源IP地址字段占32位 是发出IP分组的源主机的IP地址
   12. 目的IP地址字段 是IP分组需要送达的主机的IP地址,路由器将依据该地址检索匹配路由表,决策如何转发该IP分组
   13. 选项字段 长度可变 范围在 1-40B之间,取决与选项内容.选项字段可以携带安全,源选路径,时间戳和路由记录等内容. 
   14. 填充字段 

   - 按固定和不固定做区分
   
   1. 固定部分:
      - 版本号       4位
      - 首部长度     4位
      - 区分服务     8位
      - 总长度       16位
      - 标识         16位
      - 标志位       3位
      - 片偏移       13位
      - 生存时间     8位
      - 协议         8位
      - 首部校验和   16位   
      - 源IP地址     32位
      - 目的IP地址   32位
   2. 可变部分
      - 选项字段     1-40B 之间
      - 填充字段     0-3B
   
   - 首部固定部分有 160位 20B . 总长在64B以内, 并且是4B的倍数.  

IPV4的地址.
   
   - IPv4地址是一个32位的二进制数.
   - 点分十进制法, 采用4个十进制数字来表示一个32位的二进制数,每个十进制数字的取值范围是 0-255. (255 转成十进制是 11111111) 十进制数字中间用 . 进行分隔
   - IP地址经过三个发展阶段:
      - 分类的IP地址
         1. A类地址: 网络号占8位,主机号占24位,其中网络号最高位固定位1(第一位总是为0).
         2. B类地址: 网络号占16位,主机号占16位,其中网络号最高位固定为10.
         3. C类地址: 网络号占24位,主机号占8位,其中网络号最高位固定为110.
         4. D类地址: 最高位为1110.
         5. E类地址: 最高位为1111.
      - 子网划分
         1. 在原有二级IP地址结构的基础上,从IP地址的主机号部分借用若干位作为子网号,IP地址的结构就变成了网络号,子网号和主机号三部分
         2. 一个拥有多个物理网络的单位,可以利用子网号,将自己所管辖的物理网络划分为若干个子网.划分子网是单位内部的行为,与IP地址管理机构无关,外部网络也看不到这个单位内部划分了多少个子网,仍然将这个单位视为一个网络. 
         3. 从其他网络发送给某单位中某个主机的IP数据报,先根据其目的IP地址中的网络号找到单位网络相连接的路由器,该路由器再根据目的IP地址中的子网号找到相应的子网.最终将IP数据报发送到目的主机.
















